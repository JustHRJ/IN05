<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Home</title>
    </h:head>
    <h:body>
        <h:form id="form">
            <h:panelGrid>
                <p:row>
                    <p:column>
                        <h:outputText value="Signed in as #{user}" style="font-weight: bolder;font-size: 18px"/>

                    </p:column> 
                    <p:column width="50px" style="margin-left: 50px">
                        <h:outputText value="" style="margin-left: 523px"/>
                        <p:commandButton value="Log Out" styleClass="ui-priority-primary" action="#{csLoginManagedBean.logout()}" />
                    </p:column> 
                </p:row>
            </h:panelGrid>
        </h:form>

        <h:form id="mainForm">
            <p:growl id="msgs" showDetail="false" />

            <p></p>
            <f:ajax render=":content">
                <p:tabView dynamic="true" cache="false" >
                    <p:tab title="Profile">
                        <h:panelGrid columns="2" columnClasses="column" cellpadding="5" id="gridProfile" style="margin-left: 10px">

                            <h:outputLabel value="Click values for Editing" style="font-weight: bolder"/><br />
                            <h:outputLabel for="Name" value="Name:" />
                            <p:inplace id="Name" editor="true">
                                <p:ajax  event="save" listener="#{customerManagedBean.handleSave}" update=":mainForm:msgs"/>
                                <p:inputText value="#{customerManagedBean.customer.name}"  required="true" requiredMessage="Name is required." label="text" />
                            </p:inplace>

                            <h:outputLabel for="Address1" value="Address:" />
                            <p:inplace id="Address1" editor="true">
                                <p:ajax  event="save" listener="#{customerManagedBean.handleSave}" update=":mainForm:msgs"/>
                                <p:inputText value="#{customerManagedBean.customer.address1}" required="true" requiredMessage="Sreet name is required." label="text" />
                            </p:inplace>

                            <h:outputLabel for="Address2" value="" />
                            <p:inplace id="Address2" editor="true">
                                <p:ajax  event="save" listener="#{customerManagedBean.handleSave}" update=":mainForm:msgs"/>
                                <p:inputText value="#{customerManagedBean.customer.address2}" required="true" requiredMessage="Unit number is required." label="text" />
                            </p:inplace>

                            <h:outputLabel for="PostalCode" value="Postal Code:" />
                            <p:inplace id="PostalCode" editor="true">
                                <p:ajax  event="save" listener="#{customerManagedBean.handleSave}" update=":mainForm:msgs"/>
                                <p:inputText value="#{customerManagedBean.customer.postalCode}" required="true" maxlength="6" requiredMessage="Postal Code is required." label="text"
                                             validatorMessage="Please enter only 6 digits.">

                                    <f:validateRegex pattern="(^[0-9]{6}$)"/>
                                </p:inputText>
                            </p:inplace>

                            <h:outputLabel for="Phone" value="Phone:" />
                            <p:inplace id="Phone" editor="true">
                                <p:ajax event="save" listener="#{customerManagedBean.handleSave}" update=":mainForm:msgs"/>
                                <p:inputText value="#{customerManagedBean.customer.phone}" maxlength="8" requiredMessage="Phone is required." required="true" label="text"
                                             validatorMessage="Please enter only 8 digits.">

                                    <f:validateRegex pattern="(^[0-9]{8}$)"/>
                                </p:inputText>
                            </p:inplace>

                            <h:outputLabel for="Email" value="Email:" />
                            <p:inplace id="Email" editor="true">
                                <p:ajax event="save" listener="#{customerManagedBean.handleSave}" update=":mainForm:msgs"/>

                                <p:inputText value="#{customerManagedBean.customer.email}" required="true" label="text" requiredMessage="Email is required."
                                             validatorMessage="Invalid email format. Example: Someone@gmail.com">
                                    <f:validateRegex pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
                                </p:inputText>
                            </p:inplace>

                        </h:panelGrid>

                        <p:accordionPanel  style="width: 40%;margin-left: -10px" id="passwordPanel" activeIndex="null">
                            <p:tab title="Change Password">
                                <h:panelGrid>
                                    <p:row>
                                        <p:column>
                                            <h:outputLabel for="curPassword" value="Current Password:&nbsp;" />
                                            <p:password value="#{customerManagedBean.changePasswordInput}" inline="true" requiredMessage="Password is required." id="curPassword" />

                                        </p:column> 
                                    </p:row>
                                    <p:row>
                                        <p:column>
                                            <h:outputLabel for="newPassword" value="New Password:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" />
                                            <p:password value="#{customerManagedBean.newPassword}" feedback="true" inline="true" requiredMessage="Password is required." id="newPassword" />

                                        </p:column> 
                                    </p:row>
                                    <p:row>
                                        <p:column>
                                            <h:outputLabel for="Re-Password" value="Re-type Password:&nbsp;" />
                                            <p:password value="#{customerManagedBean.rePassword}" inline="true" requiredMessage="Password is required." id="Re-Password" />

                                        </p:column> 
                                    </p:row>
                                </h:panelGrid>
                                <br />

                                <p:commandButton value="Submit" action="#{customerManagedBean.changePassword()}" update=":mainForm:msgs " icon="ui-icon-check"/>

                            </p:tab>
                        </p:accordionPanel>

                    </p:tab>

                    <p:tab title="RFQ">
                        <p:messages id="rfqMsg"  showDetail="false" />
                        <p:panel id="content">

                            <h:outputLabel value="DATE:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                           &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#{quotationManagedBean.date}" style="font-weight: bolder">
                                <f:convertDateTime pattern="dd-MM-yyyy" />
                            </h:outputLabel><br />
                            <h:outputLabel value="TERMS OF PAYMENT:&nbsp;#{quotationManagedBean.newQuotation.termsOfPayment} days" style="font-weight: bolder"/><br />
                            <h:outputLabel value="ATTN:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                           &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#{customerManagedBean.customer.name}" style="font-weight: bolder"/><br />

                            <br />

                            <p:panelGrid id="weldPanel" columns="7">
                                <f:facet name="header">Metal Welding Job</f:facet>

                                <h:outputLabel for="Description" value="Item Desc: " />
                                <p:inputTextarea id="Description" autoResize="false" placeholder="Include metal code/name and welding instructions" value="#{quotationManagedBean.newQuotationDesc.itemDesc}" rows="6" cols="68" />
                                <h:outputLabel for="Quantity" value="Qty: " />
                                <p:inputText id="Quantity" value="#{quotationManagedBean.newQuotationDesc.qty}" maxlength="5" converterMessage="Quantity must be a number consisting of one or more digits.">
                                    <f:validateLongRange minimum="1" />
                                </p:inputText>

                                <p:commandButton value="Add" actionListener="#{quotationManagedBean.addToCacheList}" update=":mainForm:msgs mydata weldPanel" icon="ui-icon-check"  style="margin:0;height:60px">

                                </p:commandButton>
                            </p:panelGrid>

                            <p:dataTable value="#{quotationManagedBean.cacheList}" var="item" id="mydata" editable="true">

                                <p:column headerText="ID" width="10%">
                                    <h:outputText value="#{item.quotationDescNo}"/>
                                </p:column>
                                <p:column headerText="Description">
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{item.itemDesc}"/></f:facet>
                                        <f:facet name="input">
                                            <p:inputTextarea id="Description" autoResize="false" placeholder="Include metal code/name and welding instructions" value="#{item.itemDesc}" rows="6" cols="68" />
                                        </f:facet>
                                    </p:cellEditor>

                                </p:column>
                                <p:column headerText="Qty" width="10%">
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{item.qty}"/></f:facet>
                                        <f:facet name="input"><p:inputText value="#{item.qty}"/></f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column  style="width: 200px" headerText="Edit" width="6%">
                                    <p:rowEditor  />
                                </p:column>
                                <p:column headerText="Delete" width="6%">
                                    <p:commandLink update="mydata" id="deleteLink" styleClass="ui-icon ui-icon-trash" action="#{quotationManagedBean.deleteQuotationDescription(item)}"/>
                                </p:column>
                            </p:dataTable>
                            <br />
                            <p:commandButton value="Submit my request" actionListener="#{quotationManagedBean.createQuotation}" update="rfqMsg mydata weldPanel" icon="ui-icon-check">

                            </p:commandButton>
                            <br />
                            <br />
                        </p:panel>
                    </p:tab>
                    <p:tab title="Quotations">
                        <p:messages id="qMsg"  showDetail="false" />
                        <!-- <p:panel>Current(use data table with buttons and pop up for PO) and expired...</p:panel>  -->

                        <h:outputLabel value="We are glad to quote you the following:" /><br /><br />
                        <p:commandButton value="Refresh" actionListener="#{quotationManagedBean.receivedQuotations()}" update="qMsg rcvQuote" icon="ui-icon-check"/>
                        <p:dataTable value="#{quotationManagedBean.receivedQuotations}" var="item" rows="5" id="rcvQuote" paginator="true" editable="true">

                            <p:column headerText="Quotation No" width="20%">

                                <p:outputLabel value="#{item.quotationNo}"/>

                            </p:column>
                            <p:column headerText="Date (dd/mm/yyyy)" width="12%">
                                <h:outputText value="#{quotationManagedBean.formatDate(item.date)}"/>
                            </p:column>
                            <p:column headerText="Status" width="8%">
                                <h:outputText value="#{item.status}"/>
                            </p:column>
                            <p:column headerText="Payment Terms" width="10%">
                                <h:outputText value="#{item.termsOfPayment}"/>
                            </p:column>
                            <p:column style="width:32px;text-align: center">
                                <p:panel visible="#{quotationManagedBean.setVisibility(item)}" style="border:0px;background: none;">
                                    <p:commandButton id="quoteDescBtn" icon="ui-icon-search" title="View" update="quotationDetailPanel" action="#{quotationManagedBean.selectQuotation(item)}"/>
                                </p:panel>
                                <p:overlayPanel for="quoteDescBtn" showEffect="fade" hideEffect="fade" dismissable="false" showCloseIcon="true" style="width:800px">

                                    <p:outputPanel id="quotationDetailPanel" style="text-align:center;" >
                                        <p:dataTable var="quoteDescItem" value="#{quotationManagedBean.displayQuotationDescriptions}" rows="5" paginator="true">
                                            <p:column headerText="ID" width="6%">
                                                <h:outputText value="#{quoteDescItem.quotationDescNo}" />
                                            </p:column>

                                            <p:column headerText="Item Descriptions" width="60%">
                                                <h:outputText value="#{quoteDescItem.itemDesc}" />
                                            </p:column>

                                            <p:column headerText="Qty" width="8%">
                                                <h:outputText value="#{quoteDescItem.qty}" />
                                            </p:column>

                                            <p:column headerText="Quoted Price" width="10%">
                                                <h:outputText value="#{quoteDescItem.price}" />
                                            </p:column>
                                            <p:column headerText="Req for Sample" width="10%">
                                                <h:outputText value="#{quoteDescItem.requestForMetalSample}" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:outputPanel>

                                </p:overlayPanel>
                            </p:column>
                            <p:column width="12%" >
                                <p:panel id="approvalPanel"  visible="#{quotationManagedBean.setVisibility(item)}" style="border:0px;background: none;">
                                    <p:commandLink value="Accept" style="color:green" action="#{pOManagedBean.generatePurchaseOrder(item)}" update="myDialogID" /> &nbsp;|&nbsp;
                                    <p:commandLink value="Reject" style="color: red" action="#{quotationManagedBean.setRejectionStatus(item)}"/>
                                </p:panel>
                                <p:dialog id="myDialogID" widgetVar="myDialogVar" modal="true" resizable="false" header="Purchase Order" showEffect="fade" width="1100px">
                                    <p:panelGrid id="display" columns="2" columnClasses="label,value">
                                        <h:outputText value="PURCHASE NO: " style="width: 10%; font-weight: bolder"/>
                                        <h:outputText id="poId" value="#{pOManagedBean.purOrderNo}" />

                                        <h:outputText value="ATTN: " style="width: 10%; font-weight: bolder"/>
                                        <h:outputText id="attnId" value="#{pOManagedBean.attn}" />

                                        <h:outputText value="Terms of Payment: " style="width: 10%; font-weight: bolder"/>
                                        <h:outputText id="topID" value="#{pOManagedBean.paymentTerms}" />

                                        <h:outputText value="Order Date: " style="width: 10%; font-weight: bolder"/>
                                        <h:outputText id="orderDateId" value="#{pOManagedBean.orderDate}" />

                                        <h:outputText value="Expected Start Date: " style="width: 10%; font-weight: bolder"/>
                                        <h:outputText id="expectStartDateId" value="#{pOManagedBean.expectedStart}" />

                                        <h:outputText value="Expected End Date: " style="width: 10%; font-weight: bolder"/>
                                        <h:outputText id="expectEndDateId" value="#{pOManagedBean.expectedEnd}" />

                                        <h:outputText value="Item Job Description: " style="width: 10%; font-weight: bolder"/>
                                        <h:outputText id="descId" value="#{pOManagedBean.descriptions}" style="white-space: pre-wrap" escape="false"/>

                                        <h:outputText value="Total Price(SGD): " style="width: 10%; font-weight: bolder"/>
                                        <h:outputText id="totalPriceId" value="#{pOManagedBean.totalPrice}" />

                                        <p:column>
                                            <p:outputLabel for="mailingAddr1"  value="Mailing Address:" style="width: 10%; font-weight: bolder"/>

                                            <br />
                                            <br />
                                            <p:outputLabel value="*Please do not fill in if the mailing address is the same as your home address." style="font-size: 70%;color: red" />
                                        </p:column>
                                        <p:column>
                                            <p:inputText style="margin-top: 10px" placeholder="e.g. Beach Road" value="#{pOManagedBean.newPurOrder.mailingAddr1}" id="mailingAddr1"  />
                                            <br />

                                            <p:inputText placeholder="e.g. 12, #01-02" value="#{pOManagedBean.newPurOrder.mailingAddr2}" id="mailingAddr2"  />

                                        </p:column>

                                    </p:panelGrid>

                                    <br /><br />
                                    <p:commandButton icon="ui-icon-check" value="Confirm and Send PO" action="#{pOManagedBean.createPurchaseOrder(item)}" update="rcvQuote"/>


                                </p:dialog>

                            </p:column>
                        </p:dataTable>

                    </p:tab>
                    <p:tab title="PO">

                       <p:dataTable value="" var="poItem" id="rcvPO" editable="true">
                            <p:column headerText="PO No" width="15%">

                                <p:outputLabel value=""/>

                            </p:column>
                            <p:column headerText="PO Date (dd/mm/yyyy)" width="11%">
                                <h:outputText value=""/>
                            </p:column>
                            <p:column headerText="Expected Start (dd/mm/yyyy)" width="11%">
                                <h:outputText value=""/>
                            </p:column>
                            <p:column headerText="Expected End (dd/mm/yyyy)" width="11%">
                                <h:outputText value=""/>
                            </p:column>
                            <p:column headerText="Total Price" width="8%">
                                <h:outputText value=""/>
                            </p:column>
                            <p:column headerText="Mailing Address" width="17%">
                                <h:outputText value=""/>
                            </p:column>
                        </p:dataTable> 
                    </p:tab>

                    <p:tab title="Welding Job">
                        <p:panel>...</p:panel>
                    </p:tab>

                    <p:tab title="Invoices">
                        <p:panel>...</p:panel>
                    </p:tab>

                    <p:tab title="Settings">
                        <p:panel>Notifications or alerts (email, sms)...</p:panel>
                    </p:tab>
                </p:tabView>
            </f:ajax>
        </h:form>
    </h:body>
</html>

